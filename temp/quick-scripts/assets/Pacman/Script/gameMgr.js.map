{"version":3,"sources":["gameMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/Pacman/Script","sourcesContent":["// Learn TypeScript:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class NewClass extends cc.Component {\n\n    @property({ type: cc.AudioClip })\n    click_restart_sound: cc.AudioClip = null;\n\n    @property(cc.Node)\n    private gameoverNode:cc.Node = null;\n\n    @property(cc.Node)\n    private levelsuccessNode:cc.Node = null;\n\n    @property(cc.Node)\n    private timeoutNode:cc.Node = null;\n\n    @property(cc.Node)\n    private finalscoreNode:cc.Node = null;\n\n    @property(cc.Node)\n    private showScore: cc.Node = null;\n\n    @property(cc.Node)\n    private restartBtn: cc.Node = null;\n\n    @property(cc.Node)\n    private exitBtn: cc.Node = null;\n\n    private score: number = 0;\n\n    private mainScore :number = 0;\n\n    private Hscore:number = 0;\n\n    private totalScore:number = 0;\n\n    @property(cc.Node)\n    private showTime: cc.Node = null;\n\n    private timer: number = 30;\n\n    private user_ID:string = '321';\n\n    private gametime;\n\n    private isAlive:boolean = true;\n\n    private isComplete:boolean = false;\n\n    private isFind:boolean = false;\n\n    private noTime: boolean = false;\n    // LIFE-CYCLE CALLBACKS:\n\n    @property({type:cc.AudioClip})\n    bgm: cc.AudioClip = null;\n\n    @property({type:cc.AudioClip})\n    eatingEffect: cc.AudioClip = null;\n\n    @property({type:cc.AudioClip})\n    winningBgm: cc.AudioClip = null;\n\n\n    onLoad () {\n        cc.director.preloadScene(\"working\", function () {\n            cc.log(\"Next scene preloaded\");\n        });\n        this.levelsuccessNode.opacity = 0;\n        this.gameoverNode.opacity = 0;\n        //his.timeoutNode.opacity = 0;\n        //this.restartBtn.getComponent(cc.Button).interactable = false;\n        //this.exitBtn.getComponent(cc.Button).interactable = false;\n        //this.gameoverNode.getChildByName('RestartBtn').getComponent(cc.Button).interactable = false;\n        //this.gameoverNode.getChildByName('ExitBtn').getComponent(cc.Button).interactable = false;\n    }\n\n    start () {\n        this.loadUserData();\n        cc.audioEngine.play(this.bgm, false, 0.8);\n        this.schedule(function(){\n            cc.audioEngine.play(this.eatingEffect, true, 0.5);\n        },0 , 1, 4.3);\n        this.timerDown();\n    }\n\n    private timerDown(){\n        this.schedule(function(){\n            this.timer -= 1;\n            this.showTime.getComponent(cc.Label).string = String(this.timer);\n        }, 1)\n    }\n\n   \n    \n    private updateScore(num){\n        this.score += num;\n        this.showScore.getComponent(cc.Label).string = String(this.score);\n    }\n\n    private loadUserData() {\n        \n        var userEmail = firebase.auth().currentUser.email;\n        let split_name = userEmail.split('@');\n        this.user_ID = split_name[0];\n        cc.log(\"load user \",this.user_ID, \"data\");\n        //this.user_ID = firebase.auth().currentUser.uid;\n        //var scene = cc.director.getScene().name;\n\n        var userRef = firebase.database().ref(\"/user/\" + this.user_ID);\n        userRef.on(\"value\", (snapshot)=>{\n            this.Hscore = snapshot.val().status;\n            this.totalScore = snapshot.val().totalScore;\n            this.mainScore = snapshot.val().Score;\n            this.gametime = snapshot.val().time;\n        })\n\n        //timer\n        if(this.gametime < 30){\n            this.timer = this.gametime;\n        }\n    \n    }\n\n    private writedata(state:string){\n        cc.log(\"write data to database\",this.user_ID,state);\n        var userRef = firebase.database().ref(\"/user/\" + this.user_ID);\n        if(state==\"timeout\"){\n            userRef.update({\n                time: this.gametime - 30,\n                minigameScore: '0',\n                status:'endgame_pac'\n            })\n\n        }else if(state==\"gameover\"){\n            this.totalScore = this.mainScore + this.totalScore;\n            \n            if(this.Hscore < this.mainScore){ //new record\n                userRef.update({\n                    Score:this.mainScore,\n                    time: \"120\",\n                    HScore: this.mainScore,\n                    totalScore:this.totalScore,\n                    status:'start'\n                })\n\n\n            }\n            else{\n                userRef.update({\n                    Score:this.mainScore,\n                    time: \"120\",\n                    totalScore:this.totalScore,\n                    status:'start'\n                })\n\n            }\n            cc.log(\"write data when gameover\")\n\n        }else if(state==\"success\"){\n            userRef.update({\n                time: this.gametime - 30,\n                minigameScore: this.score,\n                status:'endgame_pac'\n            })\n\n        }\n        \n        \n    }\n\n    restart(){\n        cc.log('restart!');\n        //cc.audioEngine.playEffect(this.click_restart_sound,false);\n        cc.director.loadScene('working');\n    }\n    exit(){\n        cc.log('exit!');\n        //cc.audioEngine.playEffect(this.click_restart_sound,false);\n        cc.director.loadScene('userInfo');\n\n    }\n\n    private gameOver(){\n        cc.log(\"GameOver\")\n        //cc.director.pause();\n        cc.audioEngine.pauseAll();\n        this.isAlive = false;\n        this.mainScore = this.mainScore + this.score - 300; //score calculate\n\n        this.writedata(\"gameover\");\n        cc.director.loadScene('GameOver')\n        \n\n    }\n\n    backTowork(){\n        cc.director.loadScene('working');\n    }\n\n    private timeout(){\n        cc.log(\"timeout\");\n        this.isAlive = true;\n        this.writedata(\"timeout\");\n        //this.timeoutNode.opacity = 255;\n        cc.audioEngine.stopAll();\n        this.scheduleOnce(this.backTowork,3);\n        //cc.director.loadScene('working');\n        //TODO: schedule\n        //this.gameoverNode.opacity = 0;\n        //cc.director.loadScene(\"pantry\");\n\n    }\n\n    levelcomplete(){\n        cc.log(\"success\");\n        this.writedata(\"success\");\n        this.levelsuccessNode.opacity = 255;\n        cc.audioEngine.stopAll();\n        cc.audioEngine.playEffect(this.winningBgm, false);\n        this.scheduleOnce(this.backTowork,3);\n\n        //return true;\n\n    }\n\n    private notime(){\n        if (this.noTime)\n            return true;\n        else\n            return false;\n    }\n\n    update (dt) {\n        if (this.timer <= 0){\n            this.timer = 1;\n            this.noTime = true;\n            if(this.isComplete==false){\n                this.isComplete = true;\n                this.timeout();\n            }\n            \n        }\n//TODO: delete this\n        \n            \n        }\n\n\n}\n"]}